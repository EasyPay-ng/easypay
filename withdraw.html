<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EasyPay – Withdrawals</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #f0fff4;
      color: #111;
      padding: 10px;
    }

    h2 {
      text-align: center;
      color: #2d7a3e;
      margin-bottom: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
      font-size: 15px;
    }

    th, td {
      padding: 10px 8px;
      text-align: left;
      border-bottom: 1px solid #ccc;
    }

    th {
      background: #e0f4e5;
      color: #1a472a;
    }

    .status {
      padding: 5px 10px;
      border-radius: 6px;
      font-size: 13px;
      display: inline-block;
    }

    .status-pending {
      background: #ffe8cc;
      color: #b85d00;
    }

    .status-approved {
      background: #d4f8d4;
      color: #1b5e20;
    }

    .status-rejected {
      background: #ffd6d6;
      color: #a30000;
    }

    .no-log {
      text-align: center;
      font-style: italic;
      color: #666;
    }
  </style>
</head>
<body>
  <h2>User Withdrawals</h2>
  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Amount</th>
        <th>Bank</th>
        <th>Account No</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody id="withdrawalTable">
      <tr><td colspan="5" class="no-log">Loading...</td></tr>
    </tbody>
  </table>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore, collection, query, orderBy, limit,
      getDocs, doc
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDRkip46Ql5KhNfuatWAcAxQzgP5VtQ8UY",
      authDomain: "easypay-6bce8.firebaseapp.com",
      projectId: "easypay-6bce8",
      storageBucket: "easypay-6bce8.appspot.com",
      messagingSenderId: "862671358267",
      appId: "1:862671358267:web:b243c7b69840ef918c8f1e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function loadWithdrawals(uid = "Blamo") {
      const tbody = document.getElementById('withdrawalTable');
      tbody.innerHTML = '<tr><td colspan="5" class="no-log">Loading...</td></tr>';

      const ref = collection(doc(db, 'users', uid), 'withdrawals');
      const q = query(ref, orderBy('timestamp', 'desc'), limit(20));
      const snap = await getDocs(q);

      if (snap.empty) {
        tbody.innerHTML = '<tr><td colspan="5" class="no-log">No withdrawals yet.</td></tr>';
        return;
      }

      tbody.innerHTML = '';
      snap.forEach(ds => {
        const d = ds.data();
        const date = new Date(d.timestamp?.seconds * 1000).toLocaleString();
        const amount = d.amount || 0;
        const bank = d.bank || '-';
        const accNumber = d.accNumber || '-';

        // Normalize and style status
        const rawStatus = (d.status || 'pending').toLowerCase();
        let cls = 'status-pending';
        let icon = '⏳';
        let statusText = 'Pending';

        if (rawStatus === 'approved' || rawStatus === 'successful') {
          cls = 'status-approved';
          icon = '✅';
          statusText = 'Approved';
        } else if (rawStatus === 'rejected') {
          cls = 'status-rejected';
          icon = '❌';
          statusText = 'Rejected';
        }

        tbody.innerHTML += `
          <tr>
            <td>${date}</td>
            <td>₦${amount}</td>
            <td>${bank}</td>
            <td>${accNumber}</td>
            <td><span class="status ${cls}">${icon} ${statusText}</span></td>
          </tr>`;
      });
    }

    // Call function with default test UID or replace "Blamo" as needed
    loadWithdrawals("Blamo");
  </script>
</body>
</html>
