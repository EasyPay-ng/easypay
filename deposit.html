<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Submit Deposit</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f5f5f5; margin:0; padding:20px; }
    .container { max-width:600px; margin:auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
    h2 { color:#2f7a2f; margin-top:0; }
    label { display:block; margin-top:15px; font-weight:bold; }
    input, button, select { width:100%; padding:10px; margin-top:5px; border:1px solid #ccc; border-radius:5px; box-sizing:border-box; }
    button { background:#2f7a2f; color:#fff; border:none; cursor:pointer; font-size:16px; }
    button:disabled { background:#ccc; cursor:not-allowed; }
    .info { margin-top:10px; color:#333; font-size:14px; }
    .history-container { max-height:250px; overflow-y:auto; margin-top:20px; border:1px solid #ddd; border-radius:5px; }
    table { width:100%; border-collapse:collapse; }
    th, td { border:1px solid #ddd; padding:8px; text-align:left; }
    th { background:#2f7a2f; color:#fff; position:sticky; top:0; }
    #loading { display:none; text-align:center; margin:10px 0; }
    .status { padding:4px 8px; border-radius:4px; color:#fff; font-weight:bold; display:inline-block; }
    .status-approved { background:#28a745; box-shadow:0 0 8px rgba(40,167,69,0.5); }
    .status-rejected { background:#dc3545; box-shadow:0 0 8px rgba(220,53,69,0.5); }
    .status-pending  { background:#fd7e14; box-shadow:0 0 8px rgba(253,126,20,0.5); }
    .no-log { text-align:center; color:#666; padding:10px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Submit a Deposit</h2>
    <div class="info">
      <p>üìí Account Number: <strong>8125600222</strong></p>
      <p>üë§ Account Name: <strong>Onyeka Anointed Chidi</strong></p>
      <p>üè¶ Bank Name: <strong>Opay/Paycom</strong></p>
    </div><!-- Hidden fields -->
<input type="hidden" id="username" />

<label for="amount">Amount</label>
<input type="number" id="amount" min="1" placeholder="Enter amount" />

<label for="senderName">Sender Name</label>
<input type="text" id="senderName" placeholder="Your name on transfer" />

<label for="refId">Reference ID</label>
<input type="text" id="refId" readonly />

<button id="submitBtn" type="button">Submit Deposit</button>
<div id="loading">Submitting‚Ä¶</div>
<div id="msg" class="info"></div>

<h3>Deposit Records</h3>
<div class="history-container">
  <table>
    <thead>
      <tr><th>Amount</th><th>Sender</th><th>Ref ID</th><th>Status</th><th>Date</th></tr>
    </thead>
    <tbody id="history"></tbody>
  </table>
</div>

  </div>  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>  <script>
    const firebaseConfig = { apiKey:"AIzaSyDRkip46Ql5KhNfuatWAcAxQzgP5VtQ8UY", authDomain:"easypay-6bce8.firebaseapp.com", projectId:"easypay-6bce8", storageBucket:"easypay-6bce8.appspot.com", messagingSenderId:"862671358267", appId:"1:862671358267:web:b243c7b69840ef918c8f1e" };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const usernameIn = document.getElementById('username');
    const amtIn      = document.getElementById('amount');
    const senderIn   = document.getElementById('senderName');
    const refIn      = document.getElementById('refId');
    const btn        = document.getElementById('submitBtn');
    const msg        = document.getElementById('msg');
    const loadEl     = document.getElementById('loading');
    const hist       = document.getElementById('history');

    const genRef = () => Math.random().toString(36).substr(2,9);
    refIn.value = genRef();

    auth.onAuthStateChanged(async user => {
      if (!user) return window.location.href='login.html';
      try {
        const snap = await db.collection('users').doc(user.uid).get();
        usernameIn.value = (snap.data()||{}).username || user.email;
        loadHistory();
      } catch(e) { console.error(e); }
    });

    async function loadHistory() {
      hist.innerHTML = '<tr><td colspan="5" class="no-log">Loading...</td></tr>';
      const uname = usernameIn.value;
      if (!uname) return;
      try {
        const snap = await db.collection('deposits')
                             .where('username','==',uname)
                             .orderBy('date','desc')
                             .limit(20)
                             .get();
        hist.innerHTML = '';
        if (snap.empty) {
          hist.innerHTML = '<tr><td colspan="5" class="no-log">No deposits yet.</td></tr>';
        } else {
          snap.forEach(doc => {
            const d = doc.data();
            const date = new Date(d.date).toLocaleString();
            const cls = d.status === 'approved' ? 'status-approved'
                      : d.status === 'rejected'? 'status-rejected'
                      : 'status-pending';
            hist.innerHTML += `<tr>
              <td>‚Ç¶${d.amount}</td>
              <td>${d.senderName}</td>
              <td>${d.refId}</td>
              <td><span class="status ${cls}">${d.status}</span></td>
              <td>${date}</td>
            </tr>`;
          });
        }
      } catch(e) {
        console.error('History load error:', e);
        hist.innerHTML = '<tr><td colspan="5" class="no-log">Error loading records.</td></tr>';
      }
    }

    btn.addEventListener('click', async () => {
      const uname = usernameIn.value;
      const amount= parseFloat(amtIn.value);
      const sender= senderIn.value.trim();
      const refId = refIn.value;
      if (!amount || !sender) return alert('Please enter amount and sender name.');

      btn.disabled = true;
      loadEl.style.display = 'block';
      msg.textContent = '';
      try {
        await db.collection('deposits').add({ userId:auth.currentUser.uid, username:uname, amount, senderName:sender, refId, status:'pending', processed:false, date:Date.now() });
        msg.style.color = 'green'; msg.textContent = '‚úÖ Deposit request sent!';
        amtIn.value=''; senderIn.value=''; refIn.value=genRef();
        loadHistory();
      } catch(e) {
        console.error('Submission error:',e);
        msg.style.color = 'red'; msg.textContent = '‚ùå Submission failed.';
      } finally {
        btn.disabled=false; loadEl.style.display='none';
      }
    });
  </script></body>
</html>
