<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EasyPay Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <style>
    body { margin:0; font-family:'Segoe UI',sans-serif; background:#f5fdf7; color:#333; display:flex; flex-direction:column; min-height:100vh; }
    header { background:#009f4d; color:#fff; padding:15px 20px; display:flex; justify-content:space-between; align-items:center; position:relative; }
    .profile { position:relative; }
    .profile-info { display:none; position:absolute; right:0; top:50px; background:#fff; box-shadow:0 2px 6px rgba(0,0,0,0.2); border-radius:8px; width:220px; padding:10px; z-index:2; }
    .profile-info.show { display:block; }
    .profile-info p { margin:8px 0; font-size:0.95rem; }
    .profile-info .logout-btn { width:100%; padding:8px; background:#009f4d; color:#fff; border:none; border-radius:6px; cursor:pointer; font-size:0.95rem; }
    .container { padding:20px; flex:1; overflow-y:auto; }
    .card { background:#fff; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.1); padding:20px; margin-bottom:20px; }
    .copy-btn { background:#009f4d; color:#fff; border:none; padding:6px 12px; border-radius:6px; cursor:pointer; margin-top:10px; }
    .nav { position:fixed; bottom:0; width:100%; background:#009f4d; display:flex; justify-content:space-around; padding:10px 0; }
    .nav a { color:#fff; text-decoration:none; font-size:0.9rem; display:flex; flex-direction:column; align-items:center; }
    .nav a i { font-size:1.5rem; margin-bottom:4px; }
    .modal { position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.7); display:flex; justify-content:center; align-items:center; }
    .modal-content { background:#fff; padding:30px; border-radius:12px; text-align:center; max-width:90%; }
    .modal-content a { display:inline-block; margin-top:20px; padding:10px 20px; background:#009f4d; color:#fff; border-radius:6px; text-decoration:none; }
    button:disabled { opacity:0.6; cursor:default; }
  </style>
</head>
<body>
  <header>
    <h2>Welcome back, <span id="usernameDisplay"></span></h2>
    <div class="profile">
      <i class="fas fa-user-circle fa-2x" onclick="toggleProfile()"></i>
      <div id="profileInfo" class="profile-info">
        <p><strong>Username:</strong> <span id="profileUsername"></span></p>
        <p><strong>Email:</strong> <span id="profileEmail"></span></p>
        <p><strong>Balance:</strong> ₦<span id="profileBalance"></span></p>
        <button class="logout-btn" onclick="logout()">Logout</button>
      </div>
    </div>
  </header>  <!-- Upgrade prompt for basic users -->  <div id="upgradeModal" class="modal" style="display:none;">
    <div class="modal-content">
      <h2>Account Not Activated</h2>
      <p>Upgrade your plan to access features.</p>
      <a href="upgrade.html">Upgrade</a>
    </div>
  </div>  <!-- Main content -->  <div class="container" id="mainContent" style="display:none;">
    <div class="card">
      <h3>Balance: ₦<span id="balance">0.00</span></h3>
    </div>
    <div class="card">
      <h3>Total Referrals: <span id="referrals">0</span></h3>
    </div>
    <div class="card">
      <h3>Referral Code:</h3>
      <p id="referralCode" style="word-break:break-all;"></p>
      <button class="copy-btn" onclick="copyReferral()">Copy Code</button>
    </div><!-- Daily Credit Card -->
<div class="card" id="dailyCreditCard">
  <h3>Daily Credit</h3>
  <p id="creditMessage">Loading...</p>
  <button id="claimDailyBtn" disabled>Claim ₦1</button>
</div>

  </div>  <!-- Bottom nav -->  <div class="nav" id="bottomNav">
    <a href="menu.html"><i class="fas fa-home"></i>Menu</a>
    <a href="advertise.html"><i class="fas fa-bullhorn"></i>Advertise</a>
    <a href="earn.html"><i class="fas fa-money-bill-wave"></i>Earn</a>
    <a href="leaderboard.html"><i class="fas fa-trophy"></i>Leaderboard</a>
  </div>  <script>
    function toggleProfile() {
      document.getElementById('profileInfo').classList.toggle('show');
    }
    function logout() {
      import('https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js').then(({ getAuth, signOut }) => signOut(getAuth()));
    }
    function copyReferral() {
      navigator.clipboard.writeText(document.getElementById('referralCode').innerText);
    }
  </script>  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import { getFirestore, doc, getDoc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
    import { increment } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

    const firebaseConfig = { apiKey:"AIzaSyDRkip46Ql5KhNfuatWAcAxQzgP5VtQ8UY", authDomain:"easypay-6bce8.firebaseapp.com", projectId:"easypay-6bce8", storageBucket:"easypdf7…", messagingSenderId:"862671358267", appId:"1:862671358267:web:b243c7b69840ef918c8f1e" };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth();

    let userRef, userData;
    const claimBtn = document.getElementById('claimDailyBtn');
    const creditMsg = document.getElementById('creditMessage');

    onAuthStateChanged(auth, async user => {
      if (!user) return location.href='login.html';
      userRef = doc(db,'users',user.uid);
      const snap = await getDoc(userRef);
      if (!snap.exists()) return location.href='login.html';
      userData = snap.data();

      // populate header and stats
      document.getElementById('usernameDisplay').innerText = userData.username;
      document.getElementById('profileUsername').innerText = userData.username;
      document.getElementById('profileEmail').innerText = user.email;
      document.getElementById('profileBalance').innerText = (userData.balance||0).toFixed(2);
      document.getElementById('balance').innerText = (userData.balance||0).toFixed(2);
      document.getElementById('referrals').innerText = userData.referralCount||0;
      document.getElementById('referralCode').innerText = userData.username;

      // show/hide based on plan
      if (!['premium','gold','elite'].includes(userData.plan)) {
        document.getElementById('upgradeModal').style.display='flex';
        document.getElementById('mainContent').style.display='none';
        document.getElementById('bottomNav').style.display='none';
      } else {
        document.getElementById('upgradeModal').style.display='none';
        document.getElementById('mainContent').style.display='block';
        document.getElementById('bottomNav').style.display='flex';
        setupDailyCredit();
      }
    });

    function setupDailyCredit() {
      const last = userData.lastCredit?.toDate().getTime() || 0;
      const now = Date.now();
      const diff = now - last;
      if (diff >= 24*3600*1000) {
        creditMsg.innerText = 'You can claim ₦1 now!';
        claimBtn.disabled = false;
      } else {
        let remaining = 24*3600*1000 - diff;
        updateTimer(remaining);
        claimBtn.disabled = true;
        const interval = setInterval(() => {
          remaining -= 1000;
          if (remaining <= 0) {
            clearInterval(interval);
            setupDailyCredit();
          } else updateTimer(remaining);
        }, 1000);
      }
      claimBtn.onclick = async () => {
        claimBtn.disabled = true;
        try {
          await updateDoc(userRef, {
            balance: increment(1),
            lastCredit: serverTimestamp()
          });
          // add log entry
          await addDoc(collection(userRef,'transactionHistory'), { type:'Daily Credit', amount:1, timestamp: serverTimestamp() });
          // refresh
          const fresh = await getDoc(userRef);
          userData = fresh.data();
          document.getElementById('balance').innerText = (userData.balance||0).toFixed(2);
          setupDailyCredit();
        } catch {
          creditMsg.innerText = 'Error—try again later.';
        }
      };
    }

    function updateTimer(ms) {
      const h = String(Math.floor(ms/3600000)).padStart(2,'0');
      const m = String(Math.floor((ms%3600000)/60000)).padStart(2,'0');
      const s = String(Math.floor((ms%60000)/1000)).padStart(2,'0');
      creditMsg.innerText = `Next credit in ${h}:${m}:${s}`;
    }
  </script></body>
</html>
