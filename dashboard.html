<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EasyPay ‚Äî Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js" defer></script>
  <style>
    :root{
      --primary:#00b66d;
      --primary-600:#059c56;
      --bg:#f6fff7;
      --card:#ffffff;
      --muted:#6b7280;
      --shadow: 0 8px 24px rgba(16,24,40,0.06);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:'Poppins',system-ui,Segoe UI,Roboto,Helvetica,Arial;
      background:var(--bg); color:#0f1720; min-height:100vh; display:flex;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }

    /* ---------- SIDEBAR ---------- */
    .sidebar {
      position:fixed; left:-300px; top:0; height:100vh; width:300px;
      background:var(--card); box-shadow:2px 0 18px rgba(0,0,0,0.08);
      padding:18px; border-right:1px solid #f0f5f0;
      transition:left .26s ease; overflow-y:auto; z-index:1200;
      display:flex; flex-direction:column;
    }
    .sidebar.active { left:0; }
    .sidebar .close { text-align:right; margin-bottom:6px; cursor:pointer; font-size:18px; color:var(--muted) }
    .profile {
      display:flex; gap:12px; align-items:center; padding:6px 0 14px; border-bottom:1px solid #f2f7f2;
    }
    .avatar {
      width:52px; height:52px; border-radius:12px; background:linear-gradient(135deg,var(--primary),#1b7a4b);
      display:flex; align-items:center; justify-content:center; color:white; font-weight:700; font-size:18px;
      flex-shrink:0; overflow:hidden;
    }
    .avatar img{ width:100%; height:100%; object-fit:cover; display:block; border-radius:12px }
    .profile-text { flex:1 }
    .greeting { font-weight:700; font-size:15px; color:var(--primary); line-height:1 }
    .sub { font-size:13px; color:var(--muted); margin-top:4px; line-height:1.15 }

    nav.menu { margin-top:14px; flex:1 }
    nav.menu ul { list-style:none; padding:0; margin:0 }
    nav.menu li { margin:8px 0; }
    nav.menu a {
      display:flex; gap:12px; align-items:center; text-decoration:none; color: #111827;
      padding:10px 8px; border-radius:10px; transition:background .10s, transform .08s;
    }
    nav.menu a:hover { background:var(--primary); color:#fff; transform:translateX(4px); }
    nav.menu a i.emoji { font-style:normal; width:36px; text-align:center; font-size:18px; }
    nav.menu a span.label { font-weight:600; }

    .note { margin-top:18px; font-size:13px; color:var(--muted) }

    /* ---------- MAIN ---------- */
    .main {
      flex:1; margin-left:0; transition:margin-left .26s; width:100%;
      min-height:100vh; display:flex; flex-direction:column;
    }
    .main.shift { margin-left:300px; }

    header {
      background:linear-gradient(90deg,var(--primary),var(--primary-600));
      color:#fff; padding:12px 14px; display:flex; align-items:center; gap:12px;
      justify-content:space-between;
    }
    .hamburger { font-size:20px; cursor:pointer; color:#fff; display:flex; align-items:center }
    .title { font-weight:700; font-size:16px }
    .profile-mini { display:flex; align-items:center; gap:10px }
    .profile-mini img { width:36px; height:36px; border-radius:8px; object-fit:cover }

    /* content area */
    .container { padding:14px; max-width:1150px; margin:0 auto; width:100% }

    /* top cards */
    .cards {
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap:12px;
      margin-bottom:14px;
    }
    .card {
      background:var(--card); border-radius:10px; padding:12px;
      box-shadow:var(--shadow); display:flex; flex-direction:column; gap:6px;
      min-height:78px;
    }
    .card .label { color:var(--muted); font-size:13px; }
    .card .value { font-weight:800; font-size:20px; color:var(--primary); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    /* referral / code */
    .ref-card { display:flex; gap:10px; align-items:center; justify-content:space-between; padding:12px; border-radius:10px; }
    .ref-input { background:#f2fff6; border:1px dashed #e6f7ec; padding:8px 10px; border-radius:8px; min-width:0; flex:1; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; font-weight:700; color:var(--primary) }
    .copy-btn { background:var(--primary); color:#fff; border:0; padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:700; min-width:86px; }

    /* transactions */
    .tableWrap { overflow:auto; border-radius:8px; margin-top:10px; }
    .table {
      width:100%; border-collapse:collapse; min-width:640px; font-size:14px;
    }
    .table thead th { text-align:left; padding:10px 12px; color:var(--muted); font-size:13px; background:rgba(0,0,0,0.02) }
    .table tbody td { padding:10px 12px; border-bottom:1px solid #f2f2f2 }
  </style>
</head>
<body>
  <div class="sidebar" id="sidebar">
    <div class="close" onclick="toggleSidebar()"><i class="fas fa-times"></i></div>
    <div class="profile">
      <div class="avatar">U</div>
      <div class="profile-text">
        <div class="greeting">Welcome</div>
        <div class="sub" id="usernameDisplay">User</div>
      </div>
    </div>
    <nav class="menu">
      <ul>
        <li><a href="#"><i class="emoji">üè†</i><span class="label">Dashboard</span></a></li>
        <li><a href="#"><i class="emoji">üíº</i><span class="label">Tasks</span></a></li>
        <li><a href="#"><i class="emoji">üì§</i><span class="label">Withdraw</span></a></li>
      </ul>
    </nav>
    <div class="note">EasyPay ‚Äî Earn seamlessly</div>
  </div>

  <div class="main" id="main">
    <header>
      <div class="hamburger" onclick="toggleSidebar()"><i class="fas fa-bars"></i></div>
      <div class="title">Dashboard</div>
      <div class="profile-mini"><img src="https://via.placeholder.com/36" alt=""></div>
    </header>

    <div class="container">
      <!-- TOP CARDS -->
      <div class="cards">
        <div class="card">
          <div class="label">Main Balance</div>
          <div class="value" id="balance">‚Ç¶0</div>
        </div>
        <div class="card">
          <div class="label">Referrals</div>
          <div class="value" id="referrals">0</div>
        </div>
      </div>

      <!-- REFERRAL -->
      <div class="ref-card" style="background:#fff; box-shadow:var(--shadow); margin-bottom:14px;">
        <div class="ref-input" id="refLink">https://easypay.com/ref/user123</div>
        <button class="copy-btn" onclick="copyRef()">Copy</button>
      </div>

      <!-- TRANSACTIONS -->
      <h3 style="margin:10px 0;">Recent Transactions</h3>
      <div class="tableWrap">
        <table class="table">
          <thead>
            <tr>
              <th>Source</th>
              <th>Date</th>
              <th>Amount</th>
            </tr>
          </thead>
          <tbody id="transactionTableBody">
            <!-- Real-time transactions will load here -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- FIREBASE SCRIPT -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, getDoc, collection, query, orderBy, limit, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDRkip46Ql5KhNfuatWAcAxQzgP5VtQ8UY",
      authDomain: "easypay-6bce8.firebaseapp.com",
      projectId: "easypay-6bce8",
      storageBucket: "easypay-6bce8.firebasestorage.app",
      messagingSenderId: "862671358267",
      appId: "1:862671358267:web:b243c7b69840ef918c8f1e",
      measurementId: "G-2FZKDQ47FZ"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const userId = localStorage.getItem("currentUser"); // assumed stored at login

    // LOAD USER INFO
    async function loadUser() {
      if(!userId) return;
      const snap = await getDoc(doc(db, "users", userId));
      if(snap.exists()) {
        const u = snap.data();
        document.getElementById("usernameDisplay").textContent = u.username || "User";
        document.getElementById("balance").textContent = "‚Ç¶" + (u.balance || 0);
        document.getElementById("referrals").textContent = u.referrals || 0;
        document.getElementById("refLink").textContent = "https://easypay.com/ref/" + (u.username || userId);
      }
    }

    // REALTIME TRANSACTIONS
    function loadTransactions() {
      if(!userId) return;
      const tRef = collection(db, "users", userId, "transactions");
      const q = query(tRef, orderBy("date", "desc"), limit(10));

      onSnapshot(q, (snapshot) => {
        const tbody = document.getElementById("transactionTableBody");
        tbody.innerHTML = "";
        snapshot.forEach(doc => {
          const t = doc.data();
          const row = `
            <tr>
              <td>${t.source}</td>
              <td>${new Date(t.date).toLocaleString()}</td>
              <td style="font-weight:600; color:${t.amount>0?'green':'red'}">
                ‚Ç¶${t.amount}
              </td>
            </tr>`;
          tbody.innerHTML += row;
        });
      });
    }

    loadUser();
    loadTransactions();

    // COPY REF
    function copyRef() {
      const ref = document.getElementById("refLink").textContent;
      navigator.clipboard.writeText(ref);
      alert("Referral link copied!");
    }
    window.copyRef = copyRef;

    // SIDEBAR
    function toggleSidebar(){
      document.getElementById("sidebar").classList.toggle("active");
      document.getElementById("main").classList.toggle("shift");
    }
    window.toggleSidebar = toggleSidebar;
  </script>
</body>
        </html>
