<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Available Tasks</title>
  <style>
    body { margin: 0; padding: 20px; font-family: 'Segoe UI', sans-serif; background-color: #f8fff8; }
    header { text-align: center; color: #006400; font-size: 2em; margin-bottom: 20px; }
    #loginDiv { max-width: 400px; margin: 50px auto; text-align: center; }
    #loginDiv input { width: 100%; padding: 10px; margin: 8px 0; border-radius: 6px; border: 1px solid #ccc; }
    #loginDiv button { padding: 10px 20px; background: #006400; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-size: 1em; }
    #loginError { color: red; margin-top: 8px; }
    #app { display: none; max-width: 800px; margin: 0 auto; }
    #loading { text-align: center; color: #006400; font-size: 1.2em; margin-top: 20px; display: none; }
    .task { background: #fff; border: 1px solid #ccc; border-radius: 10px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .task h2 { margin: 0 0 10px; color: #006400; font-size: 1.5em; }
    .task p { margin: 8px 0; line-height: 1.4; }
    .progress-container { background: #eee; border-radius: 20px; overflow: hidden; margin: 10px 0; height: 16px; }
    .progress-bar { height: 100%; background: #28a745; width: 0%; transition: width 0.4s ease-in-out; }
    .progress-label { font-size: 12px; text-align: right; color: #004400; }
    .proof { margin-top: 15px; }
    .proof label { display: block; margin-bottom: 4px; font-weight: bold; }
    .proof textarea, .proof input[type=file] { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 6px; margin-bottom: 10px; }
    .submit-btn { padding: 8px 16px; background: #007700; color: #fff; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
    .upload-progress-container { background: #eee; border-radius: 10px; overflow: hidden; height: 10px; margin-bottom: 4px; display: none; }
    .upload-progress-bar { height: 100%; background: #28a745; width: 0%; transition: width 0.2s ease; }
    .upload-progress-label { font-size: 11px; text-align: right; color: #004400; display: none; }
  </style>
</head>
<body>
  <div id="loginDiv">
    <h2>Sign In to Continue</h2>
    <input type="email" id="email" placeholder="Email" />
    <input type="password" id="password" placeholder="Password" />
    <button id="loginBtn">Sign In</button>
    <p id="loginError"></p>
  </div>  <div id="app">
    <header>Available Tasks</header>
    <button id="logoutBtn" style="float:right; padding:6px 12px; background:#006400; color:#fff; border:none; border-radius:6px; cursor:pointer;">Sign Out</button>
    <div id="loading">Loading tasks...</div>
    <div id="taskContainer"></div>
  </div>  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>  <script>
    // Correct Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDRkip46Ql5KhNfuatWAcAxQzgP5VtQ8UY",
      authDomain: "easypay-6bce8.firebaseapp.com",
      projectId: "easypay-6bce8",
      storageBucket: "easypay-6bce8.appspot.com",
      messagingSenderId: "862671358267",
      appId: "1:862671358267:web:b243c7b69840ef918c8f1e",
      measurementId: "G-2FZKDQ47FZ"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth(), db = firebase.firestore(), storage = firebase.storage();

    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const emailInput = document.getElementById('email');
    const passInput = document.getElementById('password');
    const loginError = document.getElementById('loginError');
    const taskContainer = document.getElementById('taskContainer');
    const loadingEl = document.getElementById('loading');

    loginBtn.onclick = () => {
      loginError.textContent = '';
      auth.signInWithEmailAndPassword(emailInput.value, passInput.value)
        .catch(e => loginError.textContent = e.message);
    };
    logoutBtn.onclick = () => auth.signOut();

    auth.onAuthStateChanged(user => {
      if (user) {
        document.getElementById('loginDiv').style.display = 'none';
        document.getElementById('app').style.display = 'block';
        startTaskListener();
      } else {
        document.getElementById('loginDiv').style.display = 'block';
        document.getElementById('app').style.display = 'none';
        taskContainer.innerHTML = '';
      }
    });

    function startTaskListener() {
      loadingEl.style.display = 'block';
      db.collection('tasks').where('status','==','approved').onSnapshot(snapshot => {
        loadingEl.style.display = 'none';
        taskContainer.innerHTML = '';
        snapshot.docs.reverse().forEach(doc => renderTask(doc));
      });
    }

    function renderTask(doc) {
      const data = doc.data();
      const id = doc.id;
      const price = data.costPerUser || data.totalBudget/data.workersNeeded;
      const userPay = parseFloat((price*0.7).toFixed(2));

      const div = document.createElement('div');
      div.className = 'task';
      div.id = `task-${id}`;
      div.innerHTML = `
        <h2>${data.taskTitle} — ${data.category}</h2>
        <p>${data.description||''}</p>
        <p><strong>Earn:</strong> ₦${userPay}</p>
        <div class="progress-container"><div class="progress-bar" id="bar-${id}"></div></div>
        <div class="progress-label" id="label-${id}">0 / ${data.workersNeeded} completed</div>
        <button onclick="window.open('${data.link}','_blank')" style="padding:6px 12px; background:#006400; color:#fff; border:none; border-radius:6px; cursor:pointer;">Start Task</button>
        <div class="proof">
          <label>Text Proof:</label>
          <textarea id="text-${id}" placeholder="Enter text proof..."></textarea><label>Upload Image Proof:</label>
      <input type="file" id="file-${id}" accept="image/*" />
      <div class="upload-progress-container" id="upload-container-${id}">
        <div class="upload-progress-bar" id="upload-bar-${id}"></div>
      </div>
      <div class="upload-progress-label" id="upload-label-${id}"></div>
      <button class="submit-btn" onclick="submitProof('${id}', ${userPay})">Submit Proof</button>
    </div>
  `;
  taskContainer.appendChild(div);

  db.collection('task_submissions').where('taskId','==',id).onSnapshot(snap => {
    let done=0;
    snap.forEach(s=>{const st=s.data().status;if(st==='approved'||st==='reviewed')done++;});
    const pct=Math.min(100,Math.round((done/data.workersNeeded)*100));
    document.getElementById(`bar-${id}`).style.width=pct+'%';
    document.getElementById(`label-${id}`).textContent=`${done} / ${data.workersNeeded} completed`;
    if(done>=data.workersNeeded){document.getElementById(`task-${id}`)?.remove();db.collection('tasks').doc(id).update({status:'completed'});}        
  });
}

async function submitProof(taskId,payout){
  const user=auth.currentUser;
  if(!user)return alert('Sign in to submit');
  const text=document.getElementById(`text-${taskId}`).value.trim();
  const fileInput=document.getElementById(`file-${taskId}`);
  const file=fileInput.files[0];
  if(!text||!file)return alert('Provide text and image');

  const container=document.getElementById(`upload-container-${taskId}`);
  const bar=document.getElementById(`upload-bar-${taskId}`);
  const label=document.getElementById(`upload-label-${taskId}`);
  container.style.display='block';label.style.display='block';

  const filePath=`proof_images/${user.uid}_${Date.now()}_${file.name}`;
  const storageRef=storage.ref().child(filePath);
  const uploadTask=storageRef.put(file);

  uploadTask.on('state_changed',snap=>{
    const pct=Math.round((snap.bytesTransferred/snap.totalBytes)*100);
    bar.style.width=pct+'%';label.textContent=pct+'%';
  },err=>{label.textContent='Upload failed';},async()=>{
    const url=await uploadTask.snapshot.ref.getDownloadURL();
    await db.collection('task_submissions').add({taskId,userId:user.uid,textProof:text,imageProof:url,payout,status:'pending',submittedAt:firebase.firestore.FieldValue.serverTimestamp()});
    label.textContent='Done!';
    setTimeout(()=>{container.style.display='none';label.style.display='none';bar.style.width='0%';},1000);
    document.getElementById(`text-${taskId}`).value='';fileInput.value=null;
  });
}

  </script>
</body>
</html>
