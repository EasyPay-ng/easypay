<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EasyPay Tasks</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --primary: #00b66d;
      --bg: #f7fdf8;
      --text: #333;
      --card-bg: #fff;
      --shadow: rgba(0, 102, 51, 0.1);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Poppins', sans-serif; background: var(--bg); color: var(--text); padding: 1rem; }
    .auth-card, .tasks-container { max-width: 480px; margin: 1rem auto; }
    .auth-card { background: var(--card-bg); padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 12px var(--shadow); }
    .auth-card h2 { text-align: center; color: var(--primary); margin-bottom: 1rem; }
    .auth-card input { width: 100%; padding: 0.8rem; margin-bottom: 1rem; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; }
    .auth-card button { width: 100%; padding: 0.8rem; background: var(--primary); color: #fff; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 12px var(--shadow); }
    .auth-card p.error { color: #dc3545; font-size: 0.9rem; text-align: center; margin-top: 0.5rem; }
    .tasks-header { display: flex; justify-content: space-between; align-items: center; max-width: 480px; margin: 1.5rem auto 0; }
    .tasks-header h1 { font-size: 1.4rem; color: var(--primary); }
    .tasks-header button { background: none; border: none; color: var(--primary); font-weight: 600; cursor: pointer; }
    .task-card { background: var(--card-bg); border-radius: 12px; box-shadow: 0 4px 12px var(--shadow); margin: 1rem auto; padding: 1rem; max-width: 480px; }
    .task-card h2 { font-size: 1.1rem; margin-bottom: 0.5rem; color: var(--primary); }
    .task-card p { font-size: 0.9rem; margin-bottom: 0.8rem; line-height: 1.4; }
    .task-card .earn { font-weight: 600; margin-bottom: 0.8rem; }
    .progress-bar-bg { background: #eee; border-radius: 12px; overflow: hidden; height: 12px; margin-bottom: 0.5rem; }
    .progress-bar { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s; }
    .progress-label { font-size: 0.8rem; margin-bottom: 0.8rem; }
    .task-buttons { display: flex; gap: 0.5rem; flex-wrap: wrap; }
    .task-buttons button { flex: 1; padding: 0.6rem; background: var(--primary); color: #fff; border: none; border-radius: 8px; font-size: 0.9rem; cursor: pointer; }
    .proof-group { margin-top: 1rem; }
    .proof-group label { font-size: 0.9rem; margin-bottom: 0.3rem; display: block; }
    .proof-group textarea, .proof-group input[type=file] { width: 100%; padding: 0.6rem; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 0.8rem; }
    @media (max-width: 360px) {
      .tasks-header h1 { font-size: 1.2rem; }
      .task-card { padding: 0.8rem; }
      .task-buttons button { font-size: 0.8rem; padding: 0.5rem; }
    }
  </style>
</head>
<body>
  <div id="loginDiv" class="auth-card">
    <h2>Sign In</h2>
    <input type="email" id="email" placeholder="Email" />
    <input type="password" id="password" placeholder="Password" />
    <button id="loginBtn">Sign In</button>
    <p id="loginError" class="error"></p>
  </div>
  <div id="app">
    <div class="tasks-header">
      <h1>Available Tasks</h1>
      <button id="logoutBtn">Sign Out</button>
    </div>
    <div id="loading" class="tasks-container">Loading tasks...</div>
    <div id="taskContainer" class="tasks-container"></div>
  </div>  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>  <script>
    firebase.initializeApp({ apiKey: "AIzaSy...", authDomain: "easypay-6bce8.firebaseapp.com", projectId: "easypay-6bce8" });
    const auth = firebase.auth(), db = firebase.firestore();
    const loginDiv = document.getElementById('loginDiv'), appDiv = document.getElementById('app');
    document.getElementById('loginBtn').onclick = () => {
      document.getElementById('loginError').textContent = '';
      auth.signInWithEmailAndPassword(email.value, password.value).catch(e => document.getElementById('loginError').textContent = e.message);
    };
    document.getElementById('logoutBtn').onclick = () => auth.signOut();
    auth.onAuthStateChanged(user => {
      if (user) {
        loginDiv.style.display = 'none'; appDiv.style.display = 'block'; loadTasks(user.uid);
      } else { loginDiv.style.display = 'block'; appDiv.style.display = 'none'; }
    });
    async function loadTasks(uid) {
      loading.style.display = 'block'; taskContainer.innerHTML = '';
      const tasksSnap = await db.collection('tasks').where('status','==','approved').get();
      loading.style.display = 'none';
      const approvedSnap = await db.collection('task_submissions').where('userId','==',uid).get();
      const done = approvedSnap.docs.map(d=>d.data().taskId);
      tasksSnap.docs.forEach(doc=>{ const d=doc.data(); if(done.includes(doc.id)) return; renderTask(doc.id,d,uid); });
    }
    function renderTask(id,data,uid) {
      const userPay = ((data.costPerUser)||(data.totalBudget/data.workersNeeded))*0.7;
      const card = document.createElement('div'); card.className = 'task-card';
      card.innerHTML = `
        <h2>${data.taskTitle}</h2>
        <p>${data.description||''}</p>
        <div class="earn">Earn: â‚¦${userPay.toFixed(2)}</div>
        <div class="progress-bar-bg"><div class="progress-bar" id="bar-${id}"></div></div>
        <div class="progress-label" id="label-${id}">0 / ${data.workersNeeded}</div>
        <div class="task-buttons"><button onclick="window.open('${data.link}','_blank')">Start Task</button></div>
        <div class="proof-group">
          <label>Text Proof</label>
          <textarea id="text-${id}" rows="3"></textarea><label>Image Proof</label>
      <input type="file" id="file-${id}" accept="image/*" />
      <button onclick="submitProof('${id}',${userPay.toFixed(2)})">Submit Proof</button>
    </div>
  `;
  document.getElementById('taskContainer').appendChild(card);
  // subscribe progress
  db.collection('task_submissions').where('taskId','==',id).where('status','==','approved')
    .onSnapshot(s=>{
      const done=s.size; const pct=Math.min(100,Math.round(done/data.workersNeeded*100));
      document.getElementById(`bar-${id}`).style.width=pct+'%';
      document.getElementById(`label-${id}`).textContent=`${done} / ${data.workersNeeded}`;
      if(done>=data.workersNeeded) card.remove();
    });
}
// submitProof omitted for brevity

  </script>
</body>
</html>
