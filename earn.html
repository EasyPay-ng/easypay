<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EasyPay – Available Tasks</title>
  <style>
    body { margin: 0; padding: 20px; font-family: 'Segoe UI', sans-serif; background-color: #f8fff8; }
    #loginDiv, #app { max-width: 800px; margin: auto; }
    #loginDiv { text-align: center; padding-top: 50px; }
    #loginDiv input { width: 100%; padding: 10px; margin: 8px 0; border-radius: 6px; border: 1px solid #ccc; }
    #loginDiv button { padding: 10px 20px; background: #006400; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-size: 1em; }
    #loginError { color: red; margin-top: 8px; }
    #app { display: none; }
    #logoutBtn { float: right; padding: 6px 12px; background: #006400; color: #fff; border: none; border-radius: 6px; cursor: pointer; }
    header { text-align: center; color: #006400; font-size: 2em; margin-bottom: 20px; }
    .task { background: #fff; border: 1px solid #ccc; border-radius: 10px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .task h2 { margin: 0 0 10px; color: #006400; font-size: 1.5em; }
    .submit-btn { padding: 8px 16px; background: #007700; color: #fff; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
  </style>
</head>
<body>  <div id="loginDiv">
    <h2>Sign In to Continue</h2>
    <input type="email" id="email" placeholder="Email" />
    <input type="password" id="password" placeholder="Password" />
    <button id="loginBtn">Sign In</button>
    <p id="loginError"></p>
  </div>  <div id="app">
    <button id="logoutBtn">Sign Out</button>
    <header>EasyPay – Available Tasks</header>
    <div id="loading">Loading tasks...</div>
    <div id="taskContainer"></div>
  </div>  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>  <script>
    // Your Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDRkip46Ql5KhNfuatWAcAxQzgP5VtQ8UY",
      authDomain: "easypay-6bce8.firebaseapp.com",
      projectId: "easypay-6bce8",
      storageBucket: "easypay-6bce8.appspot.com",
      messagingSenderId: "862671358267",
      appId: "1:862671358267:web:b243c7b69840ef918c1e"
    };
    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db = firebase.firestore();

    // DOM Elements
    const loginDiv = document.getElementById('loginDiv');
    const appDiv = document.getElementById('app');
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const emailEl = document.getElementById('email');
    const passEl = document.getElementById('password');
    const loginError = document.getElementById('loginError');
    const loadingEl = document.getElementById('loading');
    const taskContainer = document.getElementById('taskContainer');

    // Sign in handler
    loginBtn.addEventListener('click', () => {
      loginError.textContent = '';
      auth.signInWithEmailAndPassword(emailEl.value, passEl.value)
        .then(() => {
          // Success
        })
        .catch(err => {
          loginError.textContent = err.message;
        });
    });

    // Sign out handler
    logoutBtn.addEventListener('click', () => auth.signOut());

    // Auth state listener
    auth.onAuthStateChanged(user => {
      if (user) {
        loginDiv.style.display = 'none';
        appDiv.style.display = 'block';
        loadTasks();
      } else {
        loginDiv.style.display = 'block';
        appDiv.style.display = 'none';
      }
    });

    // Load tasks function
    async function loadTasks() {
      loadingEl.textContent = 'Loading tasks...';
      loadingEl.style.display = 'block';
      taskContainer.innerHTML = '';

      try {
        const snap = await db.collection('tasks')
          .where('status', '==', 'approved')
          .orderBy('createdAt', 'desc')
          .get();

        if (snap.empty) {
          loadingEl.textContent = 'No available tasks.';
          return;
        }

        snap.forEach(doc => {
          const data = doc.data();
          const id = doc.id;
          // Check submissions
          db.collection('task_submissions')
            .where('taskId', '==', id)
            .where('status', '==', 'approved')
            .get()
            .then(subSnap => {
              if (subSnap.size < data.workersNeeded) {
                renderTask(id, data);
              }
            });
        });

        loadingEl.style.display = 'none';
      } catch (err) {
        loadingEl.textContent = 'Error loading tasks: ' + err.message;
      }
    }

    // Render single task
    function renderTask(id, data) {
      const price = data.costPerUser || (data.totalBudget / data.workersNeeded);
      const userPay = parseFloat((price * 0.7).toFixed(2));
      const div = document.createElement('div');
      div.className = 'task';
      div.id = `task-${id}`;

      div.innerHTML = `
        <h2>${data.taskTitle} — ${data.category}</h2>
        <p><strong>Earn:</strong> ₦${userPay}</p>
        <button onclick="window.open('${data.link}','_blank')" class="submit-btn">Start Task</button>
      `;

      taskContainer.appendChild(div);
    }
  </script></body>
</html>
